generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Task {
  id            Int          @id @default(autoincrement())
  signature     String       @unique
  slot          BigInt
  blockTimeInt  BigInt
  blockTime     DateTime
  contractType  String
  eventName     String       @default("OrderCreated")
  status        String       @default("PENDING")
  rawData       Json
  attempts      Int          @default(0)
  errorMessage  String?

  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  @@index([status])
}

model TokenPrice {
  tokenAddress      String   @id
  usdPrice  Decimal
  decimals  Int
  updatedAt DateTime @updatedAt
}

model TrnLog {
  id            Int          @id @default(autoincrement())
  orderId       String

  signature     String?   @unique
  amount        Decimal?
  tokenAddress  String?
  decimals      BigInt
  trnDate       DateTime
  trnEventType  String
  eventName     String       @default("OrderCreated")
  usdValue      Decimal?  @db.Decimal(20, 9)
  usdPrice      Decimal?  @db.Decimal(20, 9)

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@unique([orderId, trnEventType])
  @@index([signature])
}

model SyncCheckpoint {
  contractType  String   @id
  lastSignature String
  updatedAt     DateTime @updatedAt
}

model ProcessCheckpoint {
  id            Int    @id @default(1)
  lastTaskId    Int
  updatedAt     DateTime @updatedAt
}
